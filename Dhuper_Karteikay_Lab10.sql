/*
Karteikay (Karty) Dhuper
CNIT372 Lab Section # 007
Estimated Time Spent: 4 hour
Late hours used: 0
*/

SET SERVEROUTPUT ON

-- Question #1

    CREATE TABLE AIRDB_ALL_INFO AS SELECT * FROM CNIT372TA.AIRDB_ALL_INFO;

/* Q1 Query Results

    Table AIRDB_ALL_INFO created.

*/

-- Question 2

    ALTER TABLE AIRDB_ALL_INFO
    MODIFY Origin_City_Name NOT NULL;
    
    ALTER TABLE AIRDB_ALL_INFO
    MODIFY Dest_City_Name NOT NULL;
    
    ALTER TABLE AIRDB_ALL_INFO
    MODIFY Origin_State_Nm NOT NULL;
    
    ALTER TABLE AIRDB_ALL_INFO
    MODIFY Dest_State_Nm NOT NULL;
    
    ALTER TABLE AIRDB_ALL_INFO
    ADD CONSTRAINT AIRDB_ALL_INFO_UNIQUE UNIQUE(Origin_Airport_ID, Dest_Airport_ID, Fl_Num, Carrier, Fl_Date);
     
    
/* Q2 Query Results
    
    Table AIRDB_ALL_INFO altered.

    Table AIRDB_ALL_INFO altered.
    
    
    Table AIRDB_ALL_INFO altered.
    
    
    Table AIRDB_ALL_INFO altered.
    
    
    Table AIRDB_ALL_INFO altered.
*/

-- Question 3

    SELECT * FROM User_Constraints WHERE Table_Name = 'AIRDB_ALL_INFO';
    
/* Q3 Query Results:
 
    OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
    SEARCH_CONDITION_VC
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
    KDHUPER                                                                                                                          SYS_C00487886                                                                                                                    C AIRDB_ALL_INFO                                                                                                                   "ORIGIN_CITY_NAME" IS NOT NULL                                                   
    "ORIGIN_CITY_NAME" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    
    KDHUPER                                                                                                                          SYS_C00487887                                                                                                                    C AIRDB_ALL_INFO                                                                                                                   "DEST_CITY_NAME" IS NOT NULL                                                     
    "DEST_CITY_NAME" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    
    OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
    SEARCH_CONDITION_VC
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
    
    KDHUPER                                                                                                                          SYS_C00487888                                                                                                                    C AIRDB_ALL_INFO                                                                                                                   "ORIGIN_STATE_NM" IS NOT NULL                                                    
    "ORIGIN_STATE_NM" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    
    KDHUPER                                                                                                                          SYS_C00487889                                                                                                                    C AIRDB_ALL_INFO                                                                                                                   "DEST_STATE_NM" IS NOT NULL                                                      
    "DEST_STATE_NM" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    
    OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
    SEARCH_CONDITION_VC
    -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    
    KDHUPER                                                                                                                          AIRDB_ALL_INFO_UNIQUE                                                                                                            U AIRDB_ALL_INFO                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     USER NAME               01-DEC-22 KDHUPER                                                                                                                          AIRDB_ALL_INFO_UNIQUE                                                                                                                                               0    
*/

-- Question 4

    CREATE TABLE AIRDB_CLONE AS SELECT * FROM AIRDB_ALL_INFO;

/* 
-- Q4 Query Results

    Table AIRDB_CLONE created.

*/
-- Question 5

    SELECT * FROM User_Constraints WHERE Table_Name = 'AIRDB_CLONE';

/* 
-- Q5 Query Results
    
    OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION                                                                 SEARCH_CONDITION_VC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
    KDHUPER                                                                                                                          SYS_C00487896                                                                                                                    C AIRDB_CLONE                                                                                                                      "ORIGIN_CITY_NAME" IS NOT NULL                                                   "ORIGIN_CITY_NAME" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    KDHUPER                                                                                                                          SYS_C00487897                                                                                                                    C AIRDB_CLONE                                                                                                                      "ORIGIN_STATE_NM" IS NOT NULL                                                    "ORIGIN_STATE_NM" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    KDHUPER                                                                                                                          SYS_C00487898                                                                                                                    C AIRDB_CLONE                                                                                                                      "DEST_CITY_NAME" IS NOT NULL                                                     "DEST_CITY_NAME" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0
    KDHUPER                                                                                                                          SYS_C00487899                                                                                                                    C AIRDB_CLONE                                                                                                                      "DEST_STATE_NM" IS NOT NULL                                                      "DEST_STATE_NM" IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22                                                                                                                                                                                                                                                                                                      0

    It seems that cloning a table doesnt transfer the constraints that 
    were applied to the original table.
    
*/

-- Question 6
    
    ALTER TABLE AIRDB_CLONE
    ADD CONSTRAINT AIRDB_CLONE_UNIQUE UNIQUE(Origin_Airport_ID, Dest_Airport_ID, Fl_Num, Carrier, Fl_Date);
     
/* Q6 Query Results

    Table AIRDB_CLONE altered.

*/

-- Question 7

    DESCRIBE airdb_all_info;

    CREATE TABLE AIRDB_AIRPORTS(
        airport_id number, 
        city_market_id number, 
        airport_code varchar2(3) PRIMARY KEY,
        city_name varchar2(30),
        state_abr varchar2(2),
        state_fips number, 
        state_name varchar2(30)
    );
    
/* Q7 Query Results
    
    Table AIRDB_AIRPORTS created.

*/

-- Question 8

    INSERT INTO AIRDB_AIRPORTS
    SELECT origin_airport_id, origin_city_market_id, origin, origin_city_name, origin_state_abr, origin_state_fips, origin_state_nm
    FROM AIRDB_ALL_INFO
        UNION ALL
    SELECT dest_airport_id, dest_city_market_id, dest, dest_city_name, dest_state_abr, dest_state_fips, dest_state_nm
    FROM AIRDB_ALL_INFO;
    
    INSERT INTO AIRDB_AIRPORTS
    SELECT origin_airport_id, origin_city_market_id, origin, origin_city_name, origin_state_abr, origin_state_fips, origin_state_nm
    FROM AIRDB_ALL_INFO
        UNION
    SELECT dest_airport_id, dest_city_market_id, dest, dest_city_name, dest_state_abr, dest_state_fips, dest_state_nm
    FROM AIRDB_ALL_INFO;
    

/* Q8 Query Results

    Error starting at line : 163 in command -
        INSERT INTO AIRDB_AIRPORTS
        SELECT origin_airport_id, origin_city_market_id, origin, origin_city_name, origin_state_abr, origin_state_fips, origin_state_nm
        FROM AIRDB_ALL_INFO
            UNION ALL
        SELECT dest_airport_id, dest_city_market_id, dest, dest_city_name, dest_state_abr, dest_state_fips, dest_state_nm
        FROM AIRDB_ALL_INFO
    Error report -
    ORA-00001: unique constraint (KDHUPER.SYS_C00487919) violated

    294 rows inserted.

*/

-- Question 9

    ALTER TABLE AIRDB_CLONE
    ADD CONSTRAINT AIRDB_CLONE_ORIGINS_FK FOREIGN KEY(origin) REFERENCES AIRDB_AIRPORTS(airport_code);
    
    ALTER TABLE AIRDB_CLONE
    ADD CONSTRAINT AIRDB_CLONE_DEST_FK FOREIGN KEY(dest) REFERENCES AIRDB_AIRPORTS(airport_code);
    
/* Q9 Query Results

    Table AIRDB_CLONE altered.
    Table AIRDB_CLONE altered.

*/

-- Question 10

    ALTER TABLE AIRDB_CLONE
        DROP(Origin_City_Market_ID, Origin_State_Fips, Dest_City_Market_ID, Dest_State_Fips);
  
/* Q10 Query Results

    Table AIRDB_CLONE altered.

*/

-- Question 11
    
    ALTER TABLE AIRDB_AIRPORTS
        ADD CONSTRAINT AIRDB_AIRPORTS_CK CHECK(STATE_ABR IN('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 
                                                            'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 
                                                            'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 
                                                            'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 
                                                            'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 
                                                            'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 
                                                            'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY'));


/* Q11 Query Results

    Error starting at line : 222 in command -
    ALTER TABLE AIRDB_AIRPORTS
        ADD CONSTRAINT AIRDB_AIRPORTS_CK CHECK(STATE_ABR IN('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 
                                                            'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 
                                                            'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 
                                                            'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 
                                                            'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 
                                                            'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 
                                                            'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY'))
    Error report -
    ORA-02293: cannot validate (KDHUPER.AIRDB_AIRPORTS_CK) - check constraint violated
    02293. 00000 - "cannot validate (%s.%s) - check constraint violated"
    *Cause:    an alter table operation tried to validate a check constraint to
               populated table that had nocomplying values.
    *Action:   Obvious
    
    Hypothesis: This error is being thrown because we are only adding a constraint for the 
    50 US states. However, we are excluding the territories which are required.
    

*/

-- Question 12

    ALTER TABLE AIRDB_AIRPORTS
        ADD CONSTRAINT AIRDB_AIRPORTS_CK CHECK(STATE_ABR IN('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 
                                                            'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 
                                                            'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 
                                                            'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND', 
                                                            'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 
                                                            'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 
                                                            'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY'))
        DISABLE;
        
        SELECT * 
        FROM USER_CONSTRAINTS
        WHERE Table_Name LIKE 'AIRDB_AIRPORTS';

/* Q12 Query Results:

    Table AIRDB_AIRPORTS altered.
        
    OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION                                                                 SEARCH_CONDITION_VC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
    -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
    KDHUPER                                                                                                                          AIRDB_AIRPORTS_CK                                                                                                                C AIRDB_AIRPORTS                                                                                                                   STATE_ABR IN('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT',                           STATE_ABR IN('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       DISABLED NOT DEFERRABLE IMMEDIATE NOT VALIDATED USER NAME               02-DEC-22                                                                                                                                                                                                                                                                                                      0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'MI', 'MN', 'MO', 'MS', 'MT', 'NC', 'ND',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    
    KDHUPER                                                                                                                          SYS_C00487919                                                                                                                    P AIRDB_AIRPORTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          01-DEC-22 KDHUPER                                                                                                                          SYS_C00487919                                                                                                                                                       0
    

*/

-- Question 13
        
    DELETE FROM AIRDB_AIRPORTS    
    WHERE state_abr IN ('AS', 'FM', 'GU', 'MH', 'MP', 'PR', 'PW', 'VI', 'UM');

/* Q13 Query Results

    Error starting at line : 293 in command -
        DELETE FROM AIRDB_AIRPORTS    
        WHERE state_abr IN ('AS', 'FM', 'GU', 'MH', 'MP', 'PR', 'PW', 'VI', 'UM')
    Error report -
    ORA-02292: integrity constraint (KDHUPER.AIRDB_CLONE_ORIGINS_FK) violated - child record found

    THe state-abr coloumn is a foreign key of the AIRDB_CLONE table. As a result 
    the data cannot be deleted from here.
*/

-- Question 14

    ALTER TABLE AIRDB_CLONE
    DROP CONSTRAINT AIRDB_CLONE_DEST_FK;
    
    ALTER TABLE AIRDB_CLONE
    ADD CONSTRAINT AIRDB_CLONE_DEST_FK FOREIGN KEY(dest) REFERENCES AIRDB_AIRPORTS(airport_code) ON DELETE SET NULL;

/* Q14 Query Results
    
    Table AIRDB_CLONE altered.
    Table AIRDB_CLONE altered.

*/

-- Question 15
    
    ALTER TABLE AIRDB_CLONE
    DROP CONSTRAINT AIRDB_CLONE_ORIGINS_FK;
    
    ALTER TABLE AIRDB_CLONE
    ADD CONSTRAINT AIRDB_CLONE_ORIGINS_FK FOREIGN KEY(origin) REFERENCES AIRDB_AIRPORTS(airport_code) ON DELETE CASCADE;

/* Q15 Query Results

    Table AIRDB_CLONE altered.
    Table AIRDB_CLONE altered.
   
*/

-- Question 16

    DELETE FROM AIRDB_AIRPORTS    
    WHERE state_abr IN ('AS', 'FM', 'GU', 'MH', 'MP', 'PR', 'PW', 'VI', 'UM');

/* Q16 Query Results

    5 rows deleted.

    This delete works now because we set the foreign key constraints of the table 
    to cascade and be set as null. Which mitigates the error that we get where the
    child table was deleting coloumns from the parent.
*/
    
-- Question 17
    
    ALTER TABLE AIRDB_AIRPORTS
    ENABLE CONSTRAINT AIRDB_AIRPORTS_CK;

/* Q17 Query Results:

    Table AIRDB_AIRPORTS altered.
        
    This constraint works now because the extra territory abbreviations were 
    deleted from the table, allowing the 50 states to be checked without errors.

*/ 

-- Question #18

    SELECT COUNT(dest_airport_id)
    FROM AIRDB_CLONE
    WHERE dest_airport_id IS NULL;
    
    SELECT COUNT(origin_airport_id)
    FROM AIRDB_CLONE
    WHERE origin_airport_id IS NULL;
    

    SELECT COUNT(dest_airport_id)
    FROM AIRDB_ALL_INFO
    WHERE dest_airport_id IS NULL;
    
    SELECT COUNT(origin_airport_id)
    FROM AIRDB_ALL_INFO
    WHERE origin_airport_id IS NULL;

/* Q18 Query Results

    
    COUNT(DEST_AIRPORT_ID)
    ----------------------
                         0
    
    
    COUNT(ORIGIN_AIRPORT_ID)
    ------------------------
                           0

    
    COUNT(DEST_AIRPORT_ID)
    ----------------------
                         0
    
    
    COUNT(ORIGIN_AIRPORT_ID)
    ------------------------
                           0
                           
    It seems the results form counting all the null values of dept and origin 
    airport ids returns 0 for both the AIRDB_CLONE AND AIRDB_ALL_INFO tables. I 
    would think that the DELETE option we used for question 15 would make more 
    sense for the database since the set null one didn't do anything.

*/


-- Question 19

    ALTER TABLE AIRDB_AIRPORTS
    ADD CONSTRAINT AIRDB_AIRPORTS_ACODE_UQ UNIQUE(airport_code);

    ALTER TABLE AIRDB_AIRPORTS
    ADD CONSTRAINT AIRDB_AIRPORTS_NN CHECK(airport_code IS NOT NULL);

/* Q19 Query Results

    Error starting at line : 417 in command -
        ALTER TABLE AIRDB_AIRPORTS
        ADD CONSTRAINT AIRDB_AIRPORTS_ACODE_UQ UNIQUE(airport_code)
    Error report -
    ORA-02261: such unique or primary key already exists in the table
    02261. 00000 -  "such unique or primary key already exists in the table"
    *Cause:    Self-evident.
    *Action:   Remove the extra key.
    
    This likely did not work because airport_code was already declared as a 
    Primary Key, and primary keys are unique by default so this is redundant.
    
    Table AIRDB_AIRPORTS altered.

*/

-- Question #20

    ALTER TABLE AIRDB_AIRPORTS
    ADD CONSTRAINT AIRDB_AIRPORTS_CITYNAME_UQ UNIQUE(city_name);

/* Q20 Query Results
    
    Error starting at line : 443 in command -
        ALTER TABLE AIRDB_AIRPORTS
        ADD CONSTRAINT AIRDB_AIRPORTS_CITYNAME_UQ UNIQUE(city_name)
    Error report -
    ORA-02299: cannot validate (KDHUPER.AIRDB_AIRPORTS_CITYNAME_UQ) - duplicate keys found
    02299. 00000 - "cannot validate (%s.%s) - duplicate keys found"
    *Cause:    an alter table validating constraint failed because the table has
               duplicate key values.
    *Action:   Obvious
    
    This error occurs because the table alrady has coloumns that have duplicate 
    values for the city_name. Since there could multiple instances where the 
    same city is being used. This is why you are unable to set that field to be 
    unique. 

*/

-- Question #21

    DROP TABLE AIRDB_ALL_INFO CASCADE CONSTRAINTS;
    DROP TABLE AIRDB_CLONE CASCADE CONSTRAINTS;
    DROP TABLE AIRDB_AIRPORTS CASCADE CONSTRAINTS;

/* Q21 Query Results

    Table AIRDB_ALL_INFO dropped.
    Table AIRDB_CLONE dropped.
    Table AIRDB_AIRPORTS dropped.
    
*/